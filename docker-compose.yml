# ─────────────────────────────────────────────────────────────
# mobyclaw — Docker Compose stack
#
# Services:
#   moby     — AI agent (cagent serve api)
#   gateway  — Message routing (Telegram, etc.)
#
# Usage:
#   mobyclaw up    — start everything
#   mobyclaw down  — stop everything
#   mobyclaw logs  — view logs
# ─────────────────────────────────────────────────────────────

services:
  moby:
    build:
      context: .
      dockerfile: Dockerfile
    volumes:
      - ${MOBYCLAW_HOME:-~/.mobyclaw}:/home/agent/.mobyclaw
    environment:
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY:-}
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
    restart: unless-stopped
    networks:
      - mobyclaw
    deploy:
      resources:
        limits:
          memory: 2g
          cpus: "1.0"

  gateway:
    build:
      context: ./gateway
      dockerfile: Dockerfile
    ports:
      - "3000:3000"
    volumes:
      - ${MOBYCLAW_HOME:-~/.mobyclaw}:/data/.mobyclaw
    environment:
      - AGENT_URL=http://moby:8080
      - MOBYCLAW_HOME=/data/.mobyclaw
      - TELEGRAM_BOT_TOKEN=${TELEGRAM_BOT_TOKEN:-}
      - DISCORD_BOT_TOKEN=${DISCORD_BOT_TOKEN:-}
      - SLACK_BOT_TOKEN=${SLACK_BOT_TOKEN:-}
      - WHATSAPP_AUTH=${WHATSAPP_AUTH:-}
      - MOBYCLAW_HEARTBEAT_INTERVAL=${MOBYCLAW_HEARTBEAT_INTERVAL:-15m}
      - MOBYCLAW_ACTIVE_HOURS=${MOBYCLAW_ACTIVE_HOURS:-07:00-23:00}
    depends_on:
      - moby
    restart: unless-stopped
    networks:
      - mobyclaw

networks:
  mobyclaw:
    driver: bridge
